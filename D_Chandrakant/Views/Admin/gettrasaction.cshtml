@model IEnumerable<SalaryListViewModel>
@{
    Layout = "_Layout";
    var sr = 1;
}

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>D.Chandrakant Tailors </title>
    <link rel="shortcut icon" type="image/png" class="bg-black" href="../assets/images/logos/Favicon.png" />

    <link rel="stylesheet" href="../assets/css/styles.min.css" />
    <link rel="stylesheet" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" href="../assets/css/bootstrap.css">

    <link rel="stylesheet" href="/css/Datatable.css" />
   
    <!-- Fonts -->
   


   


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.css" rel="stylesheet" />
    <link rel="shortcut icon" type="image/png" class="bg-black" href="../assets/images/logos/Favicon.png" />
    <link rel="stylesheet" href="../assets/css/styles.min.css" />
    <link rel="stylesheet" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    @* <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script> *@
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.2.1/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>

</head>

<body class="bg-light-primary">


    <section class="Emp-management mb-4">
        <header class="container-fluid">
            <div class="col-6">
                <h2 class="ml-2">Transaction Details</h2>
            </div>

            <div class="row">

                <form id="monthlyReportForm" method="get" asp-action="gettransaction">
                    <div class="row">
                        <div class="col-3">
                            <div class="" id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; ">
                                <i class="bi bi-calendar3"></i>&nbsp;
                                <span id="dggf"></span> <i class="fa fa-caret-down"></i>
                            </div>
                        </div>
                        <input type="hidden" id="fromDate" name="fromDate" />
                        <input type="hidden" id="toDate" name="toDate" />

                        <div class="form-group" style="display:none">
                            <label for="employeid"></label>
                            <input type="number" id="employeid" name="employeid" class="form-control" value="@TempData["idd"]">
                        </div>
                     
                        <div class="col-3">
                            <button type="submit" class="btn btn-primary" id="filterBtn">Filter</button>
                        </div>

                     
                        

                    </div>



                </form>


                @*<form id="monthlyReportForm" method="get" asp-action="EmployeeSalary">
                <div class="form-group">
                <label for="fromDate">From Date:</label>
                <input type="date" id="fromDate" name="fromDate" class="form-control">
                </div>
                <div class="form-group">
                <label for="toDate">To Date:</label>
                <input type="date" id="toDate" name="toDate" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary">Filter</button>
                </form>*@





            </div>

            <div class="row ">

                <div class="col-6 mt-3">
                </div>
            </div>
            </div>
        </header>
        </div>
        </div>
    </section>


    @*<section class="Emp-management mb-4">
    <header class="container-fluid">
    <div class="row">
    <div class="col-3">
    <h2 class="ml-2">Employee Salary Management</h2>
    </div>
    <div class="row">
    <div class="col-md-3 mt-2 mb-2">
    <form id="monthlyReportForm">
    <div class="form-group">
    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate" name="startDate" class="form-control">
    </div>
    </form>
    </div>

    <div class="col-md-3 mt-2 mb-2">
    <div class="form-group">
    <label for="endDate">End Date:</label>
    <input type="date" id="endDate" name="endDate" class="form-control">
    </div>
    </div>



    <div class="col-6 mt-3">
    <div class="sec-div mr-2" style="display: flex; justify-content: flex-End;">
    <a class=" btn border-primary rounded-pill bg-primary text-white  " data-bs-toggle="modal" data-bs-target="#basicModal" style="width: 200px;">
    Advance Salary
    </a>
    </div>

    </div>

    </div>
    </div>


    </div>
    </header>
    </div>
    </div>
    </section>*@


    <section class="section-table">
        <section class="container-fluid">
            @*  <div class="row">
            <div class="col d-flex ">
            <div class="card w-100"> *@
            <div id="tab2Content" class="tab-content mt-4">
                <div class="card" style="padding: 30px;box-shadow:0 7px 10px 10px rgb(7 38 72 / 12%);">
                    <table table class="table" id="example" style="text-align:center;">
                        <thead>
                            <tr style="background-color: #E1E2FF;">
                                <th>Sr.No</th>
                                <th>Emp Name</th>
                                <th>Transaction Date</th>
                                <th>Paid Amt</th>
                                <th>Pending Amt</th>
                               

                            </tr>
                        </thead>
                   

                        <tbody id="salaryBody">
                            <!-- Data will be inserted here dynamically -->
                        </tbody>
                        
                    </table>
                </div>
            </div>
            </div>


        </section>
    </section>





    <!-- *************************************************-->
    <!-- *************  Add New PayRoll*-->





    <!-- *************************************************-->
    <!--*-->


    <div class="col-lg-4 col-md-6">
        <div class="mt-3">
            <!-- Modal -->
            <div class="modal  bg-transparent" id="basicModal12" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">

                        <div class="modal-header bg-primary ">
                            <h5 class="modal-title text-white">Advance Payment</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="container">
                                <div class="row">
                                    <div class="form-group col-6 col-md-6 col-lg-6">
                                        <label for="Empolyeefk">Emplyee Name</label>
                                        <input type="text" class="form-control" id="myeddittext" name="myeddittext" />
                                        <input type="text" class="form-control" id="myeddittextid" name="myeddittextid" style="display:none" />
                                    </div>

                                    <div class="form-group col-6 col-md-6 col-lg-6">
                                        <label for="empId">ID</label>
                                        <input type="text" class="form-control" name="PendingSalary1">
                                    </div>
                                    <div class="form-group col-6 col-md-6 col-lg-6" style="display:none">
                                        <label for="AdvanceSalaryDate">Adavance Amt Date</label>
                                        <input type="date" id="AdvanceSalaryDate1" name="AdvanceSalaryDate1" class="form-control">
                                    </div>

                                    <div class="form-group col-6 col-md-6 col-lg-6">

                                        <button type="button" class="btn btn-primary" style="margin-top:6%; width:10rem;border-radius:20px" onclick="savedata()">Save</button>
                                    </div>

                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
    @* ******************************************************************************************************* *@



    @* ******************************************************************************************************* *@
    <script src="~/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  

    <script>
        function initializeDataTable() {
            $('#example').DataTable({
                dom: 'Bfrtip',

                buttons: ['copy', 'csv', 'excel', 'pdf']
            });
        }


             $(document).ready(function () {
            // Today's date
            var start = moment();
            var end = moment();

            // Update the visible date text in #dggf
            function updateDateRangeDisplay(start, end) {
                $('#dggf').html(start.format('DD/MM/YYYY') + ' - ' + end.format('DD/MM/YYYY'));
            }

            // Initialize date range picker
            $('#reportrange').daterangepicker({
                startDate: start,
                endDate: end,
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, updateDateRangeDisplay);

            // Set initial display
            updateDateRangeDisplay(start, end);

            // Function to send AJAX
            function sendAjax(fromDate, toDate) {
                var employeeId = $('#employeid').val();

                $.ajax({
                    url: '/Admin/gettrasactionJson', // Change this to your actual controller route
                    type: 'GET',
                    data: {
                        employeid: employeeId,
                        fromDate: fromDate,
                        toDate: toDate
                    },
                    success: function (response) {
                        console.log('AJAX success:', response);
                            let html = '';
                            if ($.fn.DataTable.isDataTable('#example')) {
                            $('#example').DataTable().destroy();
                        }
        let sr = 1;
        response.forEach(item => {
            html += `<tr>
                        <td>${sr++}</td>
                        <td>${item.name}</td>
                        <td>${item.date}</td>
                        <td>${item.paid}</td>
                        <td>${item.pendingsal}</td>
                     </tr>`;
        });
        $('#salaryBody').html(html);
         initializeDataTable();
                    },
                    error: function (xhr, status, error) {
                        console.error('AJAX error:', error);
                    }
                });
            }

            // On form submit
            $('#monthlyReportForm').submit(function (e) {
                e.preventDefault();

                var dateRange = $('#dggf').text().trim(); // e.g., "01/07/2025 - 04/07/2025"
                var dates = dateRange.split('-');

                if (dates.length === 2) {
                    var fromDate = moment(dates[0].trim(), 'DD/MM/YYYY').format('YYYY-MM-DD');
                    var toDate = moment(dates[1].trim(), 'DD/MM/YYYY').format('YYYY-MM-DD');

                    $('#fromDate').val(fromDate);
                    $('#toDate').val(toDate);

                    sendAjax(fromDate, toDate);
                }
            });

            // Trigger initial AJAX on page load for Today
            var defaultFromDate = start.format('YYYY-MM-DD');
            var defaultToDate = end.format('YYYY-MM-DD');
            sendAjax(defaultFromDate, defaultToDate);
        });
       


        


       


        

    </script>



    





    

   
</body>

</html>