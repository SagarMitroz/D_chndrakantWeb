@model D_Chandrakant.Models.BillInfo
@{
    Layout = null;
     ViewData["Title"] = "EmpPage";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="../assets/css/styles.min.css" />
    <link rel="stylesheet" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" href="../assets/css/bootstrap.css">

    <link rel="stylesheet" href="/css/Datatable.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />


    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.css" rel="stylesheet" />


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            height: calc(100vh - 6rem);
            margin-left: auto;
            margin-right: auto;
            margin-top: 3rem;
            margin-bottom: 3rem;
            overflow-y: hidden;
        }
        /* .card {
              height: 100%;
            } */



        .responsive {
            width: 50%;
            height: auto;
            margin-left: 25%;
            margin-top: 10px;
        }

        *
        /* {
                                                           overflow: hidden;
                                                          position: fixed;
                                                        } */
        .t1 {
            width: 100%;
            height: 450px;
            table-layout: fixed;
            text-align: center;
           border-radius:5px;
            font-size: 50px;
            table,td

        {
            border: 3px solid #e9ecef;
            border-collapse: collapse;
        }

        .clickable-cell {
            cursor: pointer;
        }

        }

        hr.new5 {
            border-radius: 5px;
            width: 50%;
            margin-bottom: -8px;
        }

        .empsearchinput{
            width: 70%;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            height: 62px;
        }
        .otable{
            height: 160px;
            width: 100%;
            margin-top: 10px;
            display: flex;
            justify-content: start;
        }

        .empsearchbtn {
            background-color: #3196E7;
            width: 29%;
            border-radius: 31px;
            color: white;
            height: 62px;
            
        }
        .oqty{
            width: 100%;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-top: 20px;
            height: 62px;

        }
        @@media screen and (min-width: 1200px) {
            .t1 {
                width: 100%;
                height: 389px;
                table-layout: fixed;
                text-align: center;
                border-radius: 5px;
                font-size: 50px;}
             .empsearchbtn{
                background-color: #3196E7;
                width: 29%;
                border-radius: 31px;
                color: white;
                height: 50px;
                border: none;
             }

            .empsearchinput {
                width: 70%;
                border-radius: 10px;
                border: 1px solid #e9ecef;
             
                height: 50px;
            }

            .otable {
                height: 150px;
                width: 100%;
                margin-top: 0px;
                display: flex;
                justify-content: start;
            }

            .oqty {
                width: 100%;
                border-radius: 10px;
                border: 1px solid #e9ecef;
                margin-top: 20px;
                height: 50px;
            }

            .h4 {
                font-size: 1.2rem 19.2px;
            }

            .container {
                height: calc(100vh - 3rem);
                margin-left: auto;
                margin-right: auto;
                margin-top: 1rem;
                margin-bottom: 3rem;
                overflow-y: hidden;
            }
        }

       
    </style>



   
</head>
<body style="background-color:white">







    <div class="container " style="border:1px solid gray; border-radius:20px;background-color:#f4f7fe;">
        <!-- First Row for Nav -->
        <div class="row" >
            <nav class="navbar navbar-light " style="border-bottom:2px solid #3196E7;height:74px;background-color:#f4f7fe;display: flex;flex-wrap: nowrap;">
                <div class="container-fluid">
                    @* <a asp-controller="AuthEmp" asp-action="EmpLogin" style="text-decoration: none; color: black;font-size: 30px;margin-bottom:1%;">&larr;</a> *@

                    <span class="navbar-text ms-1">
                        <h5 style="color:  #2B3674;">Welcome, @ViewBag.Username (@ViewBag.Dept)</h5>
                    </span>
                    <button onclick="goToCart()" type="button" class="btn  btn-sm" style="margin-left:55%;width: 200px;background-color: #3196E7; align-items: center;border-radius: 25px;">
                        <img src="/assets/images/Images3/shoppingC.png" style="height: 15px;margin-bottom: 4px;">
                        <span style="color: white;font-size: 15px;">(<span id="empCount"></span>)Today Work</span>
                    </button>
                    <a asp-controller="AuthEmp" asp-action="EmpLogout">
                        <img src="/assets/images/Images3/logout.png" style="height: 30px;margin-right: 10px;">
                    </a>


                </div>
            </nav>
        </div>

        <!-- Second Row with Two Columns -->
        <div class="row">
            <div class="col-6" style="height: 100%;background-color:#f4f7fe;">
                <!-- First Column Content -->
                @* <div class="card" style="background-color:#f4f7fe;"> *@
                    <div class="card-body">
                      <div class="mt-1">
                            <h5>Barcode Id</h5>
                      </div>
                        <div class="mt-1">
                            <row style="display: ruby-text;">
                            <input class="empsearchinput" id="textSearch" placeholder="Enter ID" class="form-control ms-0"  autocomplete="off">

                            <button type="button" class="empsearchbtn" id="btnSearch" >
                                    Search <img src="/assets/images/Images3/search.png" style="height: 20px;">
                                </button>
                           </row>
                             
                         </div>

                        <div class="mt-1">
                            <h5> बारकोडची माहिती</h5>
                        </div>

                        <div class=" mt-2" style="background-color:white;" >
                            <table id="example" class="table mx-auto table-stripped otable" >

                                <tbody>
                                </tbody>


                            </table>
                        </div>

                        <div class="mt-3">
                            <h4 id="rem"><strong></strong></h4>
                        </div>
                        <div class="mb-1 mt-2">
                            <h5> आता पूर्ण झालेले काम</h5>
                        </div>
                        <div class="mb-2">
                            <input type="textbox " class="oqty" placeholder="Enter Completed Qty" id="completedQtyTextbox" class="form-control" autocomplete="off">

                        </div>
                    </div>

                  



               @*  </div> *@
            </div>
            <div class="col-6" style="height: 100%;">
                <!-- Second Column Content -->
                @* <div class="" style="background-color:#f4f7fe;"> *@
                    <div class="card-body" >

                        <table class="t1 mt-3 mb-3" style="background-color:white;border:1px solid none">
                            <tr>

                                <td class="clickable-cell" data-value="1">1</td>
                                <td class="clickable-cell" data-value="2">2</td>
                                <td class="clickable-cell" data-value="3">3</td>
                            </tr>
                            <tr>
                                <td class="clickable-cell" data-value="4">4</td>
                                <td class="clickable-cell" data-value="5">5</td>
                                <td class="clickable-cell" data-value="6">6</td>
                            </tr>
                            <tr>
                                <td class="clickable-cell" data-value="7">7</td>
                                <td class="clickable-cell" data-value="8">8</td>
                                <td class="clickable-cell" data-value="9">9</td>
                            </tr>
                            <tr>
                                <td><span id="backspaceBtn">&larr;</span></td>
                                <td class="clickable-cell" data-value="0">0</td>
                                <td style="background-color: #3196E7;color: white;">
                                <a style="height: px;width: 50px;justify-content: center;text-decoration: none;color: white; cursor: pointer;" onclick="openConfirmationModal()">OK</a>
                                @* <a style="height: px;width: 50px;justify-content: center;text-decoration: none;color: white; cursor: pointer;" onclick="sendToBackend()">OK</a> *@
                                </td>
                            </tr>
                        </table>

                    @* </div> *@
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    @* Confirmation modal *@
    <div id="confirmationModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:1050;">
        <div style="
    background:white;
    margin:5% auto;
    padding:30px;
    border-radius:15px;
    width: 90%;
    max-width: 500px;
    position:relative;
    box-shadow: 0px 4px 20px rgba(0,0,0,0.2);
  ">
            <h4 style="font-size: 20px; text-align:center; font-weight: 600;">कृपया एंटर केलेली ऑर्डर प्रती तपासा</h4>

            <input type="text" id="modalCompletedQty" class="form-control"
                   style="width:100%; font-size:18px; border-radius: 12px; border: 1px solid #ced4da; margin-top: 25px; height: 60px; padding: 10px;"
                   autocomplete="off">

            <div style="margin-top:30px; display: flex; justify-content: space-between;">
                <button onclick="closeModal()" class="btn btn-secondary" style="width:45%; height: 50px; font-size:16px;">Cancel</button>
                <button onclick="confirmSend()" class="btn btn-success" style="width:45%; height: 50px; font-size:16px;">Confirm</button>
            </div>
        </div>
    </div>



    @* ************************* MOdal ************************************** *@

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="    border-radius: 0.5rem !important;">
                <div class="modal-header" style="    align-items: center;
    display: flex;
    flex-direction:column;">
                    <h5 class="modal-title" id="exampleModalLabel" style="margin: -11px;"> Barcode Id</h5>
                    <hr class="new5" id="underline">

                </div>
                <div class="modal-body">
                    <center><p id="alertmsg"></p></center>
                </div>


                <center>
                    <button type="button" class="btn btn-primary" onclick="closepopupmodel();" style="margin-bottom: 11px;
                     border-radius: 19px;    width: 145px;">
                        Okay
                    </button>
                </center>

            </div>
        </div>
    </div>

    @* * ***********************************************************************@









</body>

<script src=""></script>




<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function () {
        // Get the textbox element
        var textBox = $('#textSearch');
        // Set focus to the textbox
        textBox.focus();
    });</script>

<script>
    function cart() {
        window.open("http://127.0.0.1:5500/Html/Cart.html")
    }
</script>

<script src="../assets/libs/jquery/dist/jquery.min.js"></script>
<script>
    function goToCart() {

        window.location.href = "/Emp/cart"; // Change "/cart" to the actual URL of your cart action
    }
</script>

<script>
    document.querySelectorAll('.clickable-cell').forEach(item => {
        item.addEventListener('click', event => {
            const value = event.target.getAttribute('data-value');
            const inputField = document.getElementById('completedQtyTextbox');
            inputField.value += value;
        });
    });
    document.getElementById('backspaceBtn').addEventListener('click', event => {
        const inputField = document.getElementById('completedQtyTextbox');
        inputField.value = inputField.value.slice(0, -1);
    });
</script>



<script>
    $(document).ready(function () {
        $.ajax({
            url: '@Url.Action("GetEmpCount", "Emp")',
            type: 'GET',
            success: function (data) {
                $('#empCount').text(data.count);
            },
            error: function () {
                $('#empCount').text('Error occurred while fetching data.');
            }
        });
    });
</script>





<script>
    $(document).ready(function () {
        $('#btnSearch').click(function () {
            $.ajax({
                url: '@Url.Action("SearchInfo", "Emp")',
                type: "GET",
                data: {
                    id: $('#textSearch').val()
                },
                dataType: "json",
                success: function (result) {


                    if (result.msg == "sucsses") {
                        console.log(result);
                        $('#example tbody').empty(); // Clear existing table rows
                        $('#rem').empty();

                        // Populate the table and other elements
                        var newRow =
                            '<tr>' +
                            '<td style="padding: .5rem 2.5rem;"> मेमो नंबर </th>' +
                            '<td style="padding: .5rem 2.5rem;"> ग्राहकाचे नाव </th>' +
                            '</tr>' +
                            '<tr>' +
                            '<th style="padding: .5rem 2.5rem;">' + result.billInfo.memoNo + '</td>' +
                            '<th style="padding: .5rem 2.5rem;">' + result.billInfo.custName + '</td>' +
                            '</tr>' +
                            '<tr>' +
                            '<td style="padding: .5rem 2.5rem;"> वस्तूचे नाव </th>' +
                            '<td style="padding: .5rem 2.5rem;"> ऑर्डर प्रमाण </th>' +
                            '</tr>' +
                            '<tr>' +
                            '<th style="padding: .5rem 2.5rem;">' + result.billInfo.itemName + '</td>' +
                            '<th style="padding: .5rem 2.5rem;">' + result.billInfo.orderedQty + '</td>' +
                            '</tr>';
                        $('#example tbody').append(newRow);

                        // Second result
                        var secondResultHeading = '<h4> <b>बाकी राहिलेले काम:<b> ' + result.billInfo.remaining + '</h5>';
                        $('#rem').html(secondResultHeading);
                    }
                    else {

                        //       exampleModalLabel underline alertmsg

                        document.getElementById("exampleModalLabel").innerHTML = "";
                        document.getElementById("alertmsg").innerHTML = "";


                        var mainmsg = document.getElementById("exampleModalLabel");

                        mainmsg.innerHTML = "बारकोड स्कॅनिंग";
                        mainmsg.style.color = "red";

                        var msgdiv = document.getElementById("alertmsg");
                        msgdiv.innerHTML = result.msg;
                        msgdiv.style.color = "Black";

                        // Select the div element by its ID
                        var myDiv = document.getElementById("underline");

                        // Change the border style
                        myDiv.style.border = "2px solid red";

                        var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
                        modal.show();
                        //  alert(result.msg);
                    }


                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });

         $('#textSearch').keydown(function (event) {
        if (event.key === "Enter") {
            $('#btnSearch').click();
        }
    });
    });


    function closepopupmodel() {
        var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
        modal.hide();

        location.reload();
    }
</script>













<script>
 

        function openConfirmationModal() {
            var mesid = $('#textSearch').val();
    var orderqty = $('#completedQtyTextbox').val();

            if (mesid.trim() === '' || orderqty.trim() === '') {
                var modalTitle = document.getElementById("exampleModalLabel");
                var modalBody = document.getElementById("alertmsg");

                modalTitle.innerHTML = "बारकोड स्कॅनिंग";
                modalTitle.style.color = "red";

                modalBody.innerHTML = "कृपया बारकोड स्कॅन करा किंवा बारकोड आय. डी एंटर करा.";
                modalBody.style.color = "black";

                var myDiv = document.getElementById("underline");
                myDiv.style.border = "2px solid red";

                var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
                modal.show();

                return;
            }

      // Get value from the original textbox
      var originalQty = document.getElementById("completedQtyTextbox").value;
      // Set it into the modal textbox
      document.getElementById("modalCompletedQty").value = originalQty;
      // Show modal
      document.getElementById("confirmationModal").style.display = "block";
    }

    function closeModal() {
      document.getElementById("confirmationModal").style.display = "none";
    }

    function confirmSend() {
      var confirmedQty = document.getElementById("modalCompletedQty").value;

      // Optionally, update the original textbox
      document.getElementById("completedQtyTextbox").value = confirmedQty;

      // Hide modal
      closeModal();

      // Proceed to backend call
      sendToBackend();
    }





    function sendToBackend() {
        var mesid = $('#textSearch').val();
        var orderqty = $('#modalCompletedQty').val();

       

        $.ajax({
            type: 'POST',
            url: '/Emp/completedQty',
            data: { id: mesid, COrderqty: orderqty },
            success: function (response) {
                console.log(response);
                var modalTitle = document.getElementById("exampleModalLabel");
                var modalBody = document.getElementById("alertmsg");
                var myDiv = document.getElementById("underline");

                if (response.error == "डेटा यशस्वीरित्या जतन केला.") {
                    modalTitle.innerHTML = "यशस्वीरित्या पूर्ण";
                    modalTitle.style.color = "green";

                    modalBody.innerHTML = "डेटा यशस्वीरित्या जतन केला.";
                    modalBody.style.color = "Black";
                    myDiv.style.border = "2px solid green";
    if (response.barcodes && response.dept == 2) {
    console.log(response.barcodes);
    var printWindow = window.open('', '_blank');

printWindow.document.write('<style>' +
    '@@page { margin: 0; size: 49.8mm 24.9mm; }' +
    'body { font-family: Arial, sans-serif; margin: 0; padding: 0; }' +
    '.label { width: 49.8mm; height: 24.9mm; margin: 0; padding: 0; box-sizing: border-box; position: relative; display: block; }' +
    '.label h3.left-text { position: absolute; left: 0.5mm; top: 50%; transform: translateY(-50%) rotate(-90deg); font-size: 8pt; font-weight: bold; margin: 0; white-space: nowrap; }' +
    '.label h3.right-text { position: absolute; right: 0.5mm; top: 50%; transform: translateY(-50%) rotate(90deg); font-size: 8pt; font-weight: bold; margin: 0; white-space: nowrap; }' +
    '.label p { margin: 0; font-size: 18pt; font-weight: bold; text-align: center; position: absolute; top: 1mm; left: 5mm; right: 5mm; }' +
    '.label img { position: absolute; bottom: 1.5mm; left: 5mm; right: 5mm; width: 39.8mm; height: 12mm; object-fit: contain; }' +
    '@@media print { body { margin: 0; padding: 0; } .label { page-break-inside: avoid; page-break-after: always; } }' +
    '</style></head><body>');
    
response.barcodes.forEach(function (barcodeUrl) {
    printWindow.document.write('<div class="label">' +
        '<h3 class="left-text">डि.चंद्रकांत</h3>' +
        '<h3 class="right-text">अ. नगर</h3>' +
        '<p>' + response.memoshow + '</p>' +
        '<img src="' + barcodeUrl + '">' +
        '</div>');
});
printWindow.document.write('</body></html>');
    printWindow.document.close();

    // Show modal after printing is done
    printWindow.onafterprint = function () {
        printWindow.close();
        var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
        modal.show();
    };

        // Print after all images are loaded
        printWindow.onload = function () {
            printWindow.focus();
            printWindow.print(); // Opens print dialog
        };
    }

                    var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
                    modal.show();
                }
                else {
                    modalTitle.innerHTML = "ऑर्डर प्रती";
                    modalTitle.style.color = "red";

                    modalBody.innerHTML = response.error;
                    modalBody.style.color = "Black";
                    myDiv.style.border = "2px solid red";

                    var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
                    modal.show();
                }
            },
            error: function (xhr, textStatus, errorThrown) {
                alert(xhr.responseText);
            }
        });
    }


</script>

</html>